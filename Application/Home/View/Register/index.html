<!DOCTYPE html>
<!-- saved from url=(0068)http://www.17sucai.com/preview/1528155/2019-03-31/ladmin/login.html# -->
<html lang="zh"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>私密圈-KEY</title>
    <link href="__PUBLIC__/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="__PUBLIC__/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/register/login.css">
    <link href="__PUBLIC__/css/xuan.css" rel="stylesheet" type="text/css"/>
    <style>
        body{
            margin: 0;
            padding: 0;
        }
        [class^="icon-"], [class*=" icon-"]{
            margin-top: 6px;
        }
        .copy_span{
            display: none;
            height: 45px;line-height: 45px;
            width: 100%;
            text-align: center;
            z-index: 1060;
            position: fixed;
            bottom: 0;
            margin: 0 0 30px;
        }
        .copy_span2{
            display: inline-block;
            text-align: center;
            background: #fff;
            width: 80px;
            border-radius: 5px;
            margin: 0 auto;
            float: none;
        }
    </style>

</head>
<body style="">

<!--<div style="height: 60px;width: 100%;background: #34435f;">

</div>-->


<style>
    .dan_upload_img_div1{
        margin: 0 auto;
        width: 100px;
        height: 100px;
        border-radius: 50%;
        padding: 0;
    }
    select, input[type="file"]{
        height: 1px;
    }
    #uploadPreview{
        margin: 5px auto;
        width: 100px;
        height: 100px;
        border-radius: 50%;
    }
    .add_head_img{
        border-radius: 50%;
        width: 100%;
        height: 100%;
    }
</style>


<div id="wrapper" class="login-page">
<div id="login_form" class="form">
<form class="register-form">
    <input style="display:none" type="text" name="fakeusernameremembered"/>
    <input style="display:none" type="password" name="fakepasswordremembered"/>
    <table style="width: 100%;">
        <tr>
            <td colspan="2">
                <div class="controls" style="margin-bottom: 40px;">
                    <label for="uploadImage">
                        <div id="upload_kuang"  class="dan_upload_img_div1">
                            <img class="add_head_img" src="__PUBLIC__/head/img/hu.jpg" alt="">
                            <div id="uploadPreview">

                            </div>
                        </div>
                    </label>

                    <input id="uploadImage" style="" type="file"  name="photoimage" class="fimg1"  />
                </div>
            </td>
        </tr>
        <tr>

            <td colspan="2">

                <input type="text" placeholder="APP名称" style="height: 50px" value="" id="name">
            </td>
        </tr>
        <tr>
            <td>
                <input type="text" placeholder="手机号" style="height: 50px;" id="phone">
            </td>
            <td style="width: 40%;">
                <input type="button" id="btn" value="发送验证码" style="border-radius: 5px;" onclick="sendcode(this)" />
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <input type="text" placeholder="验证码"  autocomplete="off" style="height: 50px;" id="code">
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <input type="password" placeholder="密码" autocomplete="off" style="height: 50px;" id="pass1">
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <input type="password" placeholder="确认密码" autocomplete="off"  style="height: 50px;" id="pass2">
            </td>
        </tr>

        <tr>
            <td colspan="2">
                <input type="text" placeholder="安卓包名"  style="height: 50px;" id="bao">
            </td>
        </tr>
    </table>





<button id="create">创建KEY</button>
<p class="message">已经有KEY? <a href="#">立刻查询</a></p>
</form>
<form class="login-form">
 <h2>查询我的KEY</h2>

<input type="text" placeholder="手机号" style="height: 50px" value="admin" id="username">
<input type="password" placeholder="密码"  style="height: 50px" id="password">
<button id="login">查 询</button>
<p class="message">还没有KEY? <a href="#">立刻创建</a></p>
</form>

</div>
</div>

<div class="modal fade" id = 'modal_alert'  style="display: none;">
    <div class="modal-dialog" >
        <div class="modal-content">
            <div class="modal-header" >
                <button type="button" class="close" data-dismiss="modal"
                        aria-label="Close">
                </button>
                <h4 class="modal-title" id='modal_alert_title'><i class="icon-exclamation-sign"></i> 消息</h4>
            </div>
            <div class="modal-body">
                <p id='modal_alert_body'>One fine body…</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id='modal_alert_yes'
                        style='margin-left:9px;background: #0dc316;'>确定</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->

</div>
<div id="newMessageDIV2">

</div>

    <div id="copy_span" class="copy_span">
        <span class="copy_span2">复制成功</span>
    </div>

<script src="__PUBLIC__/js/jquery-1.10.1.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/js/bootstrap.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/js/ajaxfileupload.js"></script>
<script type="text/javascript">

    $("#uploadImage").on("change", function(){
        // Get a reference to the fileList
        var files = !!this.files ? this.files : [];

        // If no files were selected, or no FileReader support, return
        if (!files.length || !window.FileReader) return;

        // Only proceed if the selected file is an image
        if (/^image/.test( files[0].type)){

            // Create a new instance of the FileReader
            var reader = new FileReader();

            // Read the local file as a DataURL
            reader.readAsDataURL(files[0]);

            // When loaded, set image data as background of div
            reader.onloadend = function(){
                $('.add_head_img').hide();
                $("#uploadPreview").html("<img style='width:100%;height:100%;border:1px solid #ddd;border-radius: 50%;' src='"+this.result+"'/>");
                $('.on_img_btn').hide();

                $('.change_img_btn').show().css('display','inline-block');
                $('.del_img_btn').show().css('display','inline-block');
                $("#upload_kuang").removeClass("dan_upload_img_div1");
            }
        }
    });


	function check_login()
	{
	    var username=$("#username").val();
	    var password=$("#password").val();
        if (!username){showAlert("请输入手机号");return false;}
        if (!password){showAlert("请输入密码");return false;}


        $.ajax({
            type: 'POST',
            dataType: "json",
            url: "<?php echo U('home/register/check'); ?>",
            data:{username:username, password:password},
            success: function (result) {
                if(result.code == 1){
                    showAlert("您的KEY是：<span id='content'>"+result.res+"</span>     <a href='javascript:copy()' id='btn2'>复制</a>");
                    copy();
                }else if(result.code==0){
                    var url = "<?php echo U('home/register/pass'); ?>";
                    showAlert(result.res+"                         <a href='"+url+"'>忘记密码？</a>");
                }else{
                    showAlert("提交失败，请检查您的输入是否合法");
                }
            }
        });
	}

    function copy(){
        const btn = document.querySelector('#btn2');

        btn.addEventListener('click',() => {

            const input = document.createElement('input');

            document.body.appendChild(input);
            var content = $('#content').html();
            input.setAttribute('value', content);

            input.select();

            if (document.execCommand('copy')) {

                document.execCommand('copy');
                $("#copy_span").show().delay(3000).hide(300);
                /*alert('复制成功');*/

            }
            document.body.removeChild(input);

        })
    }



    function UploadImg(){
        var img = "";
        var file = $("#uploadImage").val();
        if(file==""){
            check_register("");
        }
        else{
            //判断上传的文件的格式是否正确
            var fileType = file.substring(file.lastIndexOf(".")+1);
            if(fileType!="png"&&fileType!="jpg" &&fileType!="jpeg"){
                showAlert("上传文件格式错误");
                return false;
            }
            else{
                var url = "<?php echo U('home/register/thumb');?>";

                $.ajaxFileUpload({
                    url:url,
                    fileElementId:"uploadImage",        //file的id
                    dataType:"json",                  //返回数据类型为文本
                    success:function(res){
                        if(res){
                            img = res;
                            check_register(img);
                        }else{
                            showAlert("图片上传失败");
                        }
                    }
                })
            }
        }
    }



    function check_register(img){
		var name = $("#name").val();
		var phone = $("#phone").val();
		var pass1 = $("#pass1").val();
		var pass2 = $("#pass2").val();
		var code = $("#code").val();
		var bao = $("#bao").val();

		if (!img){
            showAlert("请上传APP的logo");return false
        }

		if (!name){showAlert("请输入APP名称");return false;}
		if (!phone){showAlert("请输入手机号");return false;}
		if (!code){showAlert("请输入验证码");return false;}
		if (!pass1){showAlert("请输入密码");return false;}
		if (pass1 != pass2){showAlert("两次密码输入不一致");return false;}
		if (!bao){showAlert("请输入安卓包名");return false;}

        $.ajax({
            type: 'POST',
            dataType: "json",
            url: "<?php echo U('home/register/add'); ?>",
            data:{name:name,
                phone:phone,
                pass1:pass1,
                code:code,
                img:img,
                bao:bao},
            success: function (result) {
                if(result.code == 1){
                    showAlert(result.res);

                    setTimeout(function(){
                        window.location.reload();
                    },2000)
                }else if(result.code==0){
                    showAlert(result.res);
                }else{
                    showAlert("提交失败，请检查您的输入是否合法");
                }
            }
        });

		/*if(name!="" && pass=="" && email != "")
		 {
             showAlert("注册成功！");
		  $("#user_name").val("");
		  $("#password").val("");
		 }
		 else
		 {
		  $("#login_form").removeClass('shake_effect');
		  setTimeout(function()
		  {
		   $("#login_form").addClass('shake_effect')
		  },1);
		 }*/
	}
	$(function(){
		$("#create").click(function(){
            UploadImg();
			return false;
		})
		$("#login").click(function(){
			check_login();
			return false;
		})
		$('.message a').click(function () {
		    $('form').animate({
		        height: 'toggle',
		        opacity: 'toggle'
		    }, 'slow');
		});


	})

    var countdown=60;
    function settime(obj) {
        if (countdown == 0) {
            obj.removeAttribute("disabled");
            obj.value="发送验证码";
            countdown = 60;
            return;
        } else {
            obj.setAttribute("disabled", true);
            obj.value="重新发送(" + countdown + ")";
            countdown--;
        }
        setTimeout(function() {
                settime(obj) }
            ,1000)
    }

    function sendcode(obj){
        var phone = $("#phone").val();
        if (!phone){
            showAlert("请输入手机号");
            return false;
        }
        $.ajax({
            type: 'POST',
            dataType: "json",
            url: "<?php echo U('home/register/sendcode'); ?>",
            data:{phone:phone},
            success: function (result) {
                if(result.code == 1){
                    settime(obj);
                    return true;
                }else if(result.code==0){
                    showAlert(result.res);
                    return false;
                }else{
                    showAlert("提交失败，请检查您的输入是否合法");
                    return false;
                }
            }
        });
    }


    function showAlert(body,callback){


        //$('#modal_alert_title')[0].innerHTML=title;
        $('#modal_alert_body')[0].innerHTML=body;
        $('#modal_alert_yes')[0].onclick=function(){
            $('#modal_alert').modal('hide');
            if(callback){
                callback();
            }
        };
        $('#modal_alert').modal('show');
        $('#modal_alert_yes')[0].focus();
    }
	</script>

</body></html>